---
keywords: fastai
description: Feature Engineering - You will now get exposure to different types of features. You will modify existing features and create new ones. Also, you will treat the missing data accordingly.
title: Winning a Kaggle Competition in Python - Part 3
toc: true
branch: master
badges: true
comments: true
author: Hai Nguyen
categories: [Kaggle, Datacamp,  Feature Engineering, Encoding, Cross-Validation, K-fold, Imputing, Missing-Data]
image: images/winning_kaggle_p3.png
hide: false
search_exclude: true
metadata_key1: metadata_value1
metadata_key2: metadata_value2
nb_path: _notebooks/Winning a Kaggle Competition in Python/2022-08-05-Chapter_3 Feature Engineering.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/Winning a Kaggle Competition in Python/2022-08-05-Chapter_3 Feature Engineering.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://github.com/anhhaibkhn/Data-Science-selfstudy-notes-Blog/tree/master/_notebooks/Winning%20a%20Kaggle%20Competition%20in%20Python"><strong>Download Datasets and Presentation slides for this post HERE</strong></a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.expand_frame_repr&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Feature-Engineering">Feature Engineering<a class="anchor-link" href="#Feature-Engineering"> </a></h2><p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/solution_workflow2.png" alt="Solution Workflow"></p>
<p>Like a Marathon, we iterate the following processs:</p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/modeling.png" alt="Modeling"></p>
<p>Feature Engineering with Domain Knowledge:</p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/domain.png" alt="Domain"></p>
<p>Feature Types:</p>
<ul>
<li>Numerical </li>
<li>Categorical</li>
<li>Datetime</li>
<li>Coordinates</li>
<li>Text</li>
<li>Images
etc.</li>
</ul>
<p>Creating Features:</p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/creating_features.png" alt="Creating Features"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Arithmetical-features">Arithmetical features<a class="anchor-link" href="#Arithmetical-features"> </a></h3><p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/Arithm_features.png" alt=""></p>
<p>Arithmetical features (Exercise):</p>
<p>To practice creating new features, you will be working with a subsample from the Kaggle competition called "House Prices: Advanced Regression Techniques". The goal of this competition is to predict the price of the house based on its properties. It's a regression problem with Root Mean Squared Error as an evaluation metric.</p>
<p>Your goal is to create new features and determine whether they improve your validation score. To get the validation score from 5-fold cross-validation, you're given the get_kfold_rmse() function. Use it with the train DataFrame, available in your workspace, as an argument.</p>
<p>Instructions:</p>
<ul>
<li>Create a new feature representing the total area (basement, 1st and 2nd floors) of the house. The columns "TotalBsmtSF", "FirstFlrSF" and "SecondFlrSF" give the areas of the basement, 1st and 2nd floors, respectively.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./datasets/house_prices_train.csv&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./datasets/house_prices_test.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_kfold_rmse</span><span class="p">(</span><span class="n">train</span><span class="p">):</span>
    <span class="n">mse_scores</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">train</span><span class="p">):</span>
        <span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">feats</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">,</span> <span class="s1">&#39;SalePrice&#39;</span><span class="p">,</span> <span class="s1">&#39;RoofStyle&#39;</span><span class="p">,</span> <span class="s1">&#39;CentralAir&#39;</span><span class="p">]]</span>
        
        <span class="n">fold_train</span><span class="p">,</span> <span class="n">fold_test</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>

        <span class="c1"># Fit the data and make predictions</span>
        <span class="c1"># Create a Random Forest object</span>
        <span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

        <span class="c1"># Train a model</span>
        <span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">fold_train</span><span class="p">[</span><span class="n">feats</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">fold_train</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">])</span>

        <span class="c1"># Get predictions for the test set</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fold_test</span><span class="p">[</span><span class="n">feats</span><span class="p">])</span>
    
        <span class="n">fold_score</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">fold_test</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">],</span> <span class="n">pred</span><span class="p">)</span>
        <span class="n">mse_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fold_score</span><span class="p">))</span>
        
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mse_scores</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">mse_scores</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>



<span class="c1"># Look at the initial RMSE</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE before feature engineering:&#39;</span><span class="p">,</span> <span class="n">get_kfold_rmse</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>

<span class="c1"># Find the total area of the house</span>
<span class="n">train</span><span class="p">[</span><span class="s1">&#39;TotalArea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;TotalBsmtSF&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;1stFlrSF&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;2ndFlrSF&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE with total area:&#39;</span><span class="p">,</span> <span class="n">get_kfold_rmse</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>

<span class="c1"># Find the area of the garden</span>
<span class="n">train</span><span class="p">[</span><span class="s1">&#39;GardenArea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;LotArea&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;1stFlrSF&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE with garden area:&#39;</span><span class="p">,</span> <span class="n">get_kfold_rmse</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>

<span class="c1"># Find total number of bathrooms</span>
<span class="n">train</span><span class="p">[</span><span class="s1">&#39;TotalBath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;FullBath&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;HalfBath&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE with number of bathrooms:&#39;</span><span class="p">,</span> <span class="n">get_kfold_rmse</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>RMSE before feature engineering: 36029.39
RMSE with total area: 35073.2
RMSE with garden area: 34413.55
RMSE with number of bathrooms: 34506.78
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p> Nice! You've created three new features. Here you see that house area improved the RMSE by almost 1,000 USD. Adding garden area improved the RMSE by another 600. However, with the total number of bathrooms, the RMSE has increased. It means that you keep the new area features, but DO NOT ADD "TotalBath" as a new feature. Let's now work with the datetime features! </p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Date-features">Date features<a class="anchor-link" href="#Date-features"> </a></h3><p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/date_features.png" alt=""></p>
<p>then we can use pandas dt method, to get the attributes which we want.</p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/date_features2.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Date features (Exercise):</p>
<p>You've built some basic features using numerical variables. Now, it's time to create features based on date and time. You will practice on a subsample from the Taxi Fare Prediction Kaggle competition data. The data represents information about the taxi rides and the goal is to predict the price for each ride.</p>
<p>Your objective is to generate date features from the pickup datetime. Recall that it's better to create new features for train and test data simultaneously. After the features are created, split the data back into the train and test DataFrames. Here it's done using pandas' isin() method.</p>
<p>The train and test DataFrames are already available in your workspace.</p>
<p>Instructions:</p>
<ul>
<li>Concatenate the train and test DataFrames into a single DataFrame taxi.</li>
<li>Convert the "pickup_datetime" column to a datetime object.</li>
<li>Create the day of week (using .dayofweek attribute) and hour (using .hour attribute) features from the "pickup_datetime" column.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./datasets/taxi_train_chapter_4.csv&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./datasets/taxi_test_chapter_4.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">taxi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">])</span>

<span class="c1"># Convert pickup date to datetime object</span>
<span class="n">taxi</span><span class="p">[</span><span class="s1">&#39;pickup_datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">taxi</span><span class="p">[</span><span class="s1">&#39;pickup_datetime&#39;</span><span class="p">])</span>

<span class="c1"># Create a day of week feature</span>
<span class="n">taxi</span><span class="p">[</span><span class="s1">&#39;dayofweek&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">taxi</span><span class="p">[</span><span class="s1">&#39;pickup_datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>

<span class="c1"># Create an hour feature</span>
<span class="n">taxi</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">taxi</span><span class="p">[</span><span class="s1">&#39;pickup_datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>

<span class="c1"># Split back into train and test</span>
<span class="n">new_train</span> <span class="o">=</span> <span class="n">taxi</span><span class="p">[</span><span class="n">taxi</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])]</span>
<span class="n">new_test</span> <span class="o">=</span> <span class="n">taxi</span><span class="p">[</span><span class="n">taxi</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Great! Now you know how to perform feature engineering for train and test DataFrames simultaneously. Having considered numerical and datetime features, move forward to master feature engineering for categorical ones!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Categorical-features">Categorical features<a class="anchor-link" href="#Categorical-features"> </a></h3><p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/categorical_features.png" alt=""></p>
<p>Example:</p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/categorical_features2.png" alt=""></p>
<p>Label encoding is working, but it may affect to the results since it creates ranking data:</p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/categorical_features3.png" alt=""></p>
<p>To overcome the label encoding problem, use One-Hot encoding:
<img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/onehot.png" alt=""></p>
<p>Binary Features:
<img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/binary_feat.png" alt=""></p>
<p>Other encoding methods:
<img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/other_encoding.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Encoding">Encoding<a class="anchor-link" href="#Encoding"> </a></h2><h3 id="Label-encoding">Label encoding<a class="anchor-link" href="#Label-encoding"> </a></h3><p>Label encoding (Exercise):</p>
<p>Let's work on categorical variables encoding. You will again work with a subsample from the House Prices Kaggle competition.</p>
<p>Your objective is to encode categorical features "RoofStyle" and "CentralAir" using label encoding. The train and test DataFrames are already available in your workspace.</p>
<p>Instructions:</p>
<ul>
<li>Concatenate train and test DataFrames into a single DataFrame houses.</li>
<li>Create a LabelEncoder object without arguments and assign it to le.</li>
<li>Create new label-encoded features for "RoofStyle" and "CentralAir" using the same le object.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./datasets/house_prices_train.csv&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./datasets/house_prices_test.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">houses</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">])</span>

<span class="c1"># Label encoder</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>

<span class="c1"># Create new features</span>
<span class="n">houses</span><span class="p">[</span><span class="s1">&#39;RoofStyle_enc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">houses</span><span class="p">[</span><span class="s1">&#39;RoofStyle&#39;</span><span class="p">])</span>
<span class="n">houses</span><span class="p">[</span><span class="s1">&#39;CentralAir_enc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">houses</span><span class="p">[</span><span class="s1">&#39;CentralAir&#39;</span><span class="p">])</span>

<span class="c1"># Look at new features</span>
<span class="n">display</span><span class="p">(</span><span class="n">houses</span><span class="p">[[</span><span class="s1">&#39;RoofStyle&#39;</span><span class="p">,</span> <span class="s1">&#39;RoofStyle_enc&#39;</span><span class="p">,</span> <span class="s1">&#39;CentralAir&#39;</span><span class="p">,</span> <span class="s1">&#39;CentralAir_enc&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RoofStyle</th>
      <th>RoofStyle_enc</th>
      <th>CentralAir</th>
      <th>CentralAir_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Gable</td>
      <td>1</td>
      <td>Y</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Gable</td>
      <td>1</td>
      <td>Y</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Gable</td>
      <td>1</td>
      <td>Y</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Gable</td>
      <td>1</td>
      <td>Y</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Gable</td>
      <td>1</td>
      <td>Y</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All right! You can see that categorical variables have been label encoded. However, as you already know, label encoder is not always a good choice for categorical variables. Let's go further and apply One-Hot encoding.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="One-Hot-encoding">One-Hot encoding<a class="anchor-link" href="#One-Hot-encoding"> </a></h3><p>One-Hot encoding (Exercise)
The problem with label encoding is that it implicitly assumes that there is a ranking dependency between the categories. So, let's change the encoding method for the features "RoofStyle" and "CentralAir" to one-hot encoding. Again, the train and test DataFrames from House Prices Kaggle competition are already available in your workspace.</p>
<p>Recall that if you're dealing with binary features (categorical features with only two categories) it is suggested to apply label encoder only.</p>
<p>Your goal is to determine which of the mentioned features is not binary, and to apply one-hot encoding only to this one.</p>
<p>Instructions:</p>
<ul>
<li>Determine the distribution of "RoofStyle" and "CentralAir" features using pandas' value_counts() method.</li>
<li>For the categorical feature "RoofStyle" let's use the one-hot encoder. Firstly, create one-hot encoded features using the get_dummies() method. Then they are concatenated to the initial houses DataFrame.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">houses</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">])</span>

<span class="c1"># Look at feature distributions</span>
<span class="nb">print</span><span class="p">(</span><span class="n">houses</span><span class="p">[</span><span class="s1">&#39;RoofStyle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">houses</span><span class="p">[</span><span class="s1">&#39;CentralAir&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Gable      2310
Hip         551
Gambrel      22
Flat         20
Mansard      11
Shed          5
Name: RoofStyle, dtype: int64 

Y    2723
N     196
Name: CentralAir, dtype: int64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.expand_frame_repr&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># Concatenate train and test together</span>
<span class="n">houses</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">])</span>

<span class="c1"># Label encode binary &#39;CentralAir&#39; feature</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">houses</span><span class="p">[</span><span class="s1">&#39;CentralAir_enc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">houses</span><span class="p">[</span><span class="s1">&#39;CentralAir&#39;</span><span class="p">])</span>

<span class="c1"># Create One-Hot encoded features</span>
<span class="n">ohe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">houses</span><span class="p">[</span><span class="s1">&#39;RoofStyle&#39;</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;RoofStyle&#39;</span><span class="p">)</span>

<span class="c1"># Concatenate OHE features to houses</span>
<span class="n">houses</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">houses</span><span class="p">,</span> <span class="n">ohe</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Look at OHE features</span>
<span class="n">display</span><span class="p">(</span><span class="n">houses</span><span class="p">[[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">houses</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;RoofStyle&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RoofStyle</th>
      <th>RoofStyle_Flat</th>
      <th>RoofStyle_Gable</th>
      <th>RoofStyle_Gambrel</th>
      <th>RoofStyle_Hip</th>
      <th>RoofStyle_Mansard</th>
      <th>RoofStyle_Shed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Gable</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Gable</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Gable</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Question
Which of the features is binary?
----&gt; "CentralAir".</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Target-encoding">Target encoding<a class="anchor-link" href="#Target-encoding"> </a></h3><p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/target_encode.png" alt=""></p>
<p>High cardinality categorical features:</p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/high_cardinality_problem.png" alt=""></p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/mean_target_encoding1.png" alt=""></p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/mean_target_encoding2.png" alt=""></p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/mean_target_encoding3.png" alt=""></p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/mean_target_encoding4.png" alt=""></p>
<p>Some extra tips:</p>
<ul>
<li>Smoothing</li>
</ul>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/mean_target_encoding5.png" alt=""></p>
<ul>
<li>Global mean for new category: (C: 2/5 = 0.4)</li>
</ul>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/mean_target_encoding6.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Mean-target-encoding">Mean target encoding<a class="anchor-link" href="#Mean-target-encoding"> </a></h3><p>Mean target encoding (Exercise):</p>
<p>First of all, you will create a function that implements mean target encoding. Remember that you need to develop the two following steps:</p>
<p>Calculate the mean on the train, apply to the test
Split train into K folds. Calculate the out-of-fold mean for each fold, apply to this particular fold
Each of these steps will be implemented in a separate function: test_mean_target_encoding() and train_mean_target_encoding(), respectively.</p>
<p>The final function mean_target_encoding() takes as arguments: the train and test DataFrames, the name of the categorical column to be encoded, the name of the target column and a smoothing parameter alpha. It returns two values: a new feature for train and test DataFrames, respectively.</p>
<p>Instructions:</p>
<ul>
<li>You need to add smoothing to avoid overfitting. So, add  parameter to the denominator in train_statistics calculations.</li>
<li>You need to treat new categories in the test data. So, pass a global mean as an argument to the fillna() method.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_mean_target_encoding</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">categorical</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c1"># Calculate global mean on the train data</span>
    <span class="n">global_mean</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    
    <span class="c1"># Group by the categorical feature and calculate its properties</span>
    <span class="n">train_groups</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">categorical</span><span class="p">)</span>
    <span class="n">category_sum</span> <span class="o">=</span> <span class="n">train_groups</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">category_size</span> <span class="o">=</span> <span class="n">train_groups</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    
    <span class="c1"># Calculate smoothed mean target statistics</span>
    <span class="n">train_statistics</span> <span class="o">=</span> <span class="p">(</span><span class="n">category_sum</span> <span class="o">+</span> <span class="n">global_mean</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">category_size</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">)</span>
    
    <span class="c1"># Apply statistics to the test data and fill new categories</span>
    <span class="n">test_feature</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">categorical</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">train_statistics</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">global_mean</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_feature</span><span class="o">.</span><span class="n">values</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>To calculate the train mean encoded feature you need to use out-of-fold statistics, splitting train into several folds. Specify the train and test indices for each validation split to access it.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">train_mean_target_encoding</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">categorical</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c1"># Create 5-fold cross-validation</span>
    <span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">train_feature</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">train</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
    
    <span class="c1"># For each folds split</span>
    <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">train</span><span class="p">):</span>
        <span class="n">cv_train</span><span class="p">,</span> <span class="n">cv_test</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
      
        <span class="c1"># Calculate out-of-fold statistics and apply to cv_test</span>
        <span class="n">cv_test_feature</span> <span class="o">=</span> <span class="n">test_mean_target_encoding</span><span class="p">(</span><span class="n">cv_train</span><span class="p">,</span> <span class="n">cv_test</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">categorical</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
        
        <span class="c1"># Save new feature for this particular fold</span>
        <span class="n">train_feature</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv_test_feature</span>       
    <span class="k">return</span> <span class="n">train_feature</span><span class="o">.</span><span class="n">values</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Finally, you just calculate train and test target mean encoded features and return them from the function. So, return train_feature and test_feature obtained.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">mean_target_encoding</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">categorical</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
  
    <span class="c1"># Get the train feature</span>
    <span class="n">train_feature</span> <span class="o">=</span> <span class="n">train_mean_target_encoding</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">categorical</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
  
    <span class="c1"># Get the test feature</span>
    <span class="n">test_feature</span> <span class="o">=</span> <span class="n">test_mean_target_encoding</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">categorical</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
    
    <span class="c1"># Return new features to add to the model</span>
    <span class="k">return</span> <span class="n">train_feature</span><span class="p">,</span> <span class="n">test_feature</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now you are equipped with a function that performs mean target encoding of any categorical feature. Move on to learn how to implement mean target encoding for the K-fold cross-validation using the mean_target_encoding() function you've just built!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Cross-Validation">Cross Validation<a class="anchor-link" href="#Cross-Validation"> </a></h2><h3 id="K-fold-cross-validation">K-fold cross-validation<a class="anchor-link" href="#K-fold-cross-validation"> </a></h3><p>K-fold cross-validation (Exercise)</p>
<p>You will work with a binary classification problem on a subsample from Kaggle playground competition. The objective of this competition is to predict whether a famous basketball player Kobe Bryant scored a basket or missed a particular shot.</p>
<p>Train data is available in your workspace as bryant_shots DataFrame. It contains data on 10,000 shots with its properties and a target variable "shot_made_flag" -- whether shot was scored or not.</p>
<p>One of the features in the data is "game_id" -- a particular game where the shot was made. There are 541 distinct games. So, you deal with a <strong>high-cardinality</strong> categorical feature. Let's encode it using <strong>a target mean</strong>!</p>
<p>Suppose you're using 5-fold cross-validation and want to evaluate a mean target encoded feature on the local validation.</p>
<p>Instructions:</p>
<ul>
<li>To achieve this, you need to repeat encoding procedure for the "game_id" categorical feature inside each folds split separately. Your goal is to specify all the missing parameters for the mean_target_encoding() function call inside each folds split.</li>
<li>Recall that the train and test parameters expect the train and test DataFrames.</li>
<li>While the target and categorical parameters expect names of the target variable and categorical feature to be encoded.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bryant_shots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./datasets/bryant_shots.csv&#39;</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">bryant_shots</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">bryant_shots</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">bryant_shots</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bryant_shots</span><span class="o">.</span><span class="n">game_id</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>shot_id</th>
      <th>game_id</th>
      <th>lat</th>
      <th>lon</th>
      <th>minutes_remaining</th>
      <th>playoffs</th>
      <th>season</th>
      <th>shot_distance</th>
      <th>shot_type</th>
      <th>shot_made_flag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>20000012</td>
      <td>34.0443</td>
      <td>-118.4268</td>
      <td>10</td>
      <td>0</td>
      <td>2000-01</td>
      <td>15</td>
      <td>2PT Field Goal</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>20000012</td>
      <td>33.9093</td>
      <td>-118.3708</td>
      <td>7</td>
      <td>0</td>
      <td>2000-01</td>
      <td>16</td>
      <td>2PT Field Goal</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>20000012</td>
      <td>33.8693</td>
      <td>-118.1318</td>
      <td>6</td>
      <td>0</td>
      <td>2000-01</td>
      <td>22</td>
      <td>2PT Field Goal</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5</td>
      <td>20000012</td>
      <td>34.0443</td>
      <td>-118.2698</td>
      <td>6</td>
      <td>0</td>
      <td>2000-01</td>
      <td>0</td>
      <td>2PT Field Goal</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6</td>
      <td>20000012</td>
      <td>34.0553</td>
      <td>-118.4148</td>
      <td>9</td>
      <td>0</td>
      <td>2000-01</td>
      <td>14</td>
      <td>2PT Field Goal</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>shot_id</th>
      <th>game_id</th>
      <th>lat</th>
      <th>lon</th>
      <th>minutes_remaining</th>
      <th>playoffs</th>
      <th>shot_distance</th>
      <th>shot_made_flag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>10000.000000</td>
      <td>1.000000e+04</td>
      <td>10000.000000</td>
      <td>10000.000000</td>
      <td>10000.000000</td>
      <td>10000.0</td>
      <td>10000.00000</td>
      <td>10000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>5957.429200</td>
      <td>2.032651e+07</td>
      <td>33.957233</td>
      <td>-118.260528</td>
      <td>4.969800</td>
      <td>0.0</td>
      <td>13.25660</td>
      <td>0.450800</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3449.286328</td>
      <td>2.137839e+05</td>
      <td>0.088840</td>
      <td>0.111615</td>
      <td>3.530911</td>
      <td>0.0</td>
      <td>9.54781</td>
      <td>0.497598</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.000000</td>
      <td>2.000001e+07</td>
      <td>33.303300</td>
      <td>-118.514800</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2953.750000</td>
      <td>2.010106e+07</td>
      <td>33.886300</td>
      <td>-118.335800</td>
      <td>2.000000</td>
      <td>0.0</td>
      <td>4.00000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>5957.500000</td>
      <td>2.030103e+07</td>
      <td>33.977300</td>
      <td>-118.269800</td>
      <td>5.000000</td>
      <td>0.0</td>
      <td>15.00000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>8935.250000</td>
      <td>2.050081e+07</td>
      <td>34.044300</td>
      <td>-118.166800</td>
      <td>8.000000</td>
      <td>0.0</td>
      <td>20.00000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>11934.000000</td>
      <td>2.070036e+07</td>
      <td>34.088300</td>
      <td>-118.021800</td>
      <td>11.000000</td>
      <td>0.0</td>
      <td>74.00000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 10000 entries, 0 to 9999
Data columns (total 10 columns):
 #   Column             Non-Null Count  Dtype  
---  ------             --------------  -----  
 0   shot_id            10000 non-null  int64  
 1   game_id            10000 non-null  int64  
 2   lat                10000 non-null  float64
 3   lon                10000 non-null  float64
 4   minutes_remaining  10000 non-null  int64  
 5   playoffs           10000 non-null  int64  
 6   season             10000 non-null  object 
 7   shot_distance      10000 non-null  int64  
 8   shot_type          10000 non-null  object 
 9   shot_made_flag     10000 non-null  float64
dtypes: float64(3), int64(5), object(2)
memory usage: 781.4+ KB
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>None</pre>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>541
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># For each folds split</span>
<span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bryant_shots</span><span class="p">):</span>
    <span class="n">cv_train</span><span class="p">,</span> <span class="n">cv_test</span> <span class="o">=</span> <span class="n">bryant_shots</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">bryant_shots</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Create mean target encoded feature</span>
    <span class="n">cv_train</span><span class="p">[</span><span class="s1">&#39;game_id_enc&#39;</span><span class="p">],</span> <span class="n">cv_test</span><span class="p">[</span><span class="s1">&#39;game_id_enc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_target_encoding</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="n">cv_train</span><span class="p">,</span>
                                                                           <span class="n">test</span><span class="o">=</span><span class="n">cv_test</span><span class="p">,</span>
                                                                           <span class="n">target</span><span class="o">=</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">,</span>
                                                                           <span class="n">categorical</span><span class="o">=</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span>
                                                                           <span class="n">alpha</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="c1"># Look at the encoding</span>
    <span class="n">display</span><span class="p">(</span><span class="n">cv_train</span><span class="p">[[</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span> <span class="s1">&#39;shot_made_flag&#39;</span><span class="p">,</span> <span class="s1">&#39;game_id_enc&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>game_id</th>
      <th>shot_made_flag</th>
      <th>game_id_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6169</th>
      <td>20401035</td>
      <td>0.0</td>
      <td>0.485855</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>game_id</th>
      <th>shot_made_flag</th>
      <th>game_id_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5423</th>
      <td>20400158</td>
      <td>0.0</td>
      <td>0.327632</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>game_id</th>
      <th>shot_made_flag</th>
      <th>game_id_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5429</th>
      <td>20400181</td>
      <td>1.0</td>
      <td>0.589342</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>game_id</th>
      <th>shot_made_flag</th>
      <th>game_id_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7871</th>
      <td>20501026</td>
      <td>1.0</td>
      <td>0.313008</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>game_id</th>
      <th>shot_made_flag</th>
      <th>game_id_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6887</th>
      <td>20500372</td>
      <td>1.0</td>
      <td>0.376618</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You could see different game encodings for each validation split in the output. The main conclusion you should make: <strong>while using local cross-validation, you need to repeat mean target encoding procedure inside each folds split separately</strong>. Go on to try other problem types beyond binary classification!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Beyond-binary-classification">Beyond binary classification<a class="anchor-link" href="#Beyond-binary-classification"> </a></h3><p>Beyond binary classification (Exercise)</p>
<p>Of course, binary classification is just a single special case. Target encoding could be applied to any target variable type:</p>
<p>For binary classification usually mean target encoding is used
For regression mean could be changed to median, quartiles, etc.
For multi-class classification with N classes we create N features with target mean for each category in one vs. all fashion
The mean_target_encoding() function you've created could be used for any target type specified above. Let's apply it for the regression problem on the example of House Prices Kaggle competition.</p>
<p>Your goal is to encode a categorical feature "RoofStyle" using mean target encoding. The train and test DataFrames are already available in your workspace.</p>
<p>Instructions:</p>
<ul>
<li>Specify all the missing parameters for the mean_target_encoding() function call. Target variable name is "SalePrice". Set  hyperparameter to 10.</li>
<li>Recall that the train and test parameters expect the train and test DataFrames.</li>
<li>While the target and categorical parameters expect names of the target variable and feature to be encoded.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./datasets/house_prices_train.csv&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./datasets/house_prices_test.csv&#39;</span><span class="p">)</span>

<span class="c1"># Create mean target encoded feature</span>
<span class="n">train</span><span class="p">[</span><span class="s1">&#39;RoofStyle_enc&#39;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;RoofStyle_enc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_target_encoding</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
                                                                     <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">,</span> 
                                                                     <span class="n">target</span><span class="o">=</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">,</span>
                                                                     <span class="n">categorical</span><span class="o">=</span><span class="s1">&#39;RoofStyle&#39;</span><span class="p">,</span>
                                                                     <span class="n">alpha</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Look at the encoding</span>
<span class="n">test</span><span class="p">[[</span><span class="s1">&#39;RoofStyle&#39;</span><span class="p">,</span> <span class="s1">&#39;RoofStyle_enc&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RoofStyle</th>
      <th>RoofStyle_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Gable</td>
      <td>171565.947836</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Hip</td>
      <td>217594.645131</td>
    </tr>
    <tr>
      <th>98</th>
      <td>Gambrel</td>
      <td>164152.950424</td>
    </tr>
    <tr>
      <th>133</th>
      <td>Flat</td>
      <td>188703.563431</td>
    </tr>
    <tr>
      <th>362</th>
      <td>Mansard</td>
      <td>180775.938759</td>
    </tr>
    <tr>
      <th>1053</th>
      <td>Shed</td>
      <td>188267.663242</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, you observe that houses with the <strong>Hip roof are the most pricy</strong>, while houses with the Gambrel roof are the cheapest. It's exactly the goal of target encoding: you've encoded categorical feature in such a manner that there is now a correlation between category values and target variable. We're done with categorical encoders. Now it's time to talk about the missing data!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Missing-Data">Missing Data<a class="anchor-link" href="#Missing-Data"> </a></h2><p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/missing_data.png" alt=""></p>
<ul>
<li>Mean/median imputation</li>
</ul>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/impute1.png" alt=""></p>
<ul>
<li>Constant value imputation </li>
</ul>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/impute2.png" alt=""></p>
<ul>
<li>Most frequent category imputation</li>
</ul>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/impute3.png" alt=""></p>
<ul>
<li>New category imputation</li>
</ul>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/impute4.png" alt=""></p>
<h3 id="Find-Missing-Data">Find Missing Data<a class="anchor-link" href="#Find-Missing-Data"> </a></h3><p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/find_missing.png" alt=""></p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/numerical_impute.png" alt=""></p>
<p><img src="/Data-Science-selfstudy-notes-Blog/images/copied_from_nb/./images/categorical_impute.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Find missing data (Exercise):</p>
<p>Let's impute missing data on a real Kaggle dataset. For this purpose, you will be using a data subsample from the Kaggle "Two sigma connect: rental listing inquiries" competition.</p>
<p>Before proceeding with any imputing you need to know the number of missing values for each of the features. Moreover, if the feature has missing values, you should explore the type of this feature.</p>
<p>Instructions:</p>
<ul>
<li>Read the "twosigma_train.csv" file using pandas.</li>
<li>Find the number of missing values in each column.</li>
<li>Select the columns with the missing values and look at the head of the DataFrame.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">twosigma</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./datasets/twosigma_rental_train_null.csv&#39;</span><span class="p">)</span>
<span class="c1"># Find the number of missing values in each column</span>
<span class="nb">print</span><span class="p">(</span><span class="n">twosigma</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="c1"># Look at the columns with the missing values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">twosigma</span><span class="p">[[</span><span class="s1">&#39;building_id&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>id                 0
bathrooms          0
bedrooms           0
building_id       13
latitude           0
longitude          0
manager_id         0
price             32
interest_level     0
dtype: int64
                        building_id   price
0  53a5b119ba8f7b61d4e010512e0dfc85  3000.0
1  c5c8a357cba207596b04d1afd1e4f130  5465.0
2  c3ba40552e2120b0acfc3cb5730bb2aa  2850.0
3  28d9ad350afeaab8027513a3e52ac8d5  3275.0
4                               NaN  3350.0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All right, you've found out that 'building_id' and 'price' columns have missing values. Looking at the head of the DataFrame, we may conclude that 'price' is a numerical feature, while 'building_id' is a categorical feature that is encoding buildings as hashes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Imputing-Missing-Data">Imputing Missing Data<a class="anchor-link" href="#Imputing-Missing-Data"> </a></h3><p>Impute missing data (Exercise)</p>
<p>You've found that "price" and "building_id" columns have missing values in the Rental Listing Inquiries dataset. So, before passing the data to the models you need to impute these values.</p>
<p>Numerical feature "price" will be encoded with a mean value of non-missing prices.</p>
<p>Imputing categorical feature "building_id" with the most frequent category is a bad idea, because it would mean that all the apartments with a missing "building_id" are located in the most popular building. The better idea is to impute it with a new category.</p>
<p>The DataFrame rental_listings with competition data is read for you.</p>
<p>Instructions:</p>
<ul>
<li>Create a SimpleImputer object with "mean" strategy.</li>
<li><p>Impute missing prices with the mean value.</p>
</li>
<li><p>Create an imputer with "constant" strategy. Use "MISSING" as fill_value.</p>
</li>
<li>Impute missing buildings with a constant value.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="n">rental_listings</span> <span class="o">=</span> <span class="n">twosigma</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Create mean imputer</span>
<span class="n">mean_imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>

<span class="c1"># Price imputation</span>
<span class="n">rental_listings</span><span class="p">[[</span><span class="s1">&#39;price&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mean_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">rental_listings</span><span class="p">[[</span><span class="s1">&#39;price&#39;</span><span class="p">]])</span>


<span class="c1"># Create constant imputer</span>
<span class="n">constant_imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;MISSING&quot;</span><span class="p">)</span>

<span class="c1"># building_id imputation</span>
<span class="n">rental_listings</span><span class="p">[[</span><span class="s1">&#39;building_id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">constant_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">rental_listings</span><span class="p">[[</span><span class="s1">&#39;building_id&#39;</span><span class="p">]])</span>


<span class="nb">print</span><span class="p">(</span><span class="n">rental_listings</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>id                0
bathrooms         0
bedrooms          0
building_id       0
latitude          0
longitude         0
manager_id        0
price             0
interest_level    0
dtype: int64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Nice! Now our data is ready to be passed to any Machine Learning model. Move on to the next chapter to build and improve your models!</p>

</div>
</div>
</div>
</div>
 

